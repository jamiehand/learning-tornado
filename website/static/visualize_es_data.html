<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- meta: needed to ensure that the browser can
        parse D3â€™s functions and data properly -->
        <meta charset="utf-8">
        <title>Static File</title>
        <!-- this script tag: locates d3 in d3 directory -->
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
            text {
                font-family: sans-serif;
                font-size: 12px;
                fill: white;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript">
        // hard brackets [] indicate an array, and
        // curly brackets {} indicate an object.
            var dataset = [];
            var color = d3.scale.category10();
            var barPadding = 3;

            // define a key function, to be used whenever we bind
            // data to elements. This function specifies to take the key value
            // of whatever d object is passed into it.
            var key = function(d) {
                return d.key;
            };

            var w = 500;
            var h = 300;


            d3.json("/es/", function(
                error, jsonList) {
                if (error) return console.warn(error);
                // console.log(jsonList[0]._source.authors)
                console.log(jsonList);
                console.log(dataset);


                dataset = getTagCounts(jsonList); // pass the jsonList dict to separate its tags
                console.log(dataset);
                makeBarChart(dataset);
            });

            function getTagCounts(docList) {
                var tagsObj = {}; // TODO or {} ?
                var i;
                var tempTags;

                var dataLen = docList.length;
                for (i=0; i<dataLen; i++){
                    tempTags = docList[i]._source.tags;
                    // console.log(tempTags);
                    // for (index in tempTags)
                    tempTags.forEach(
                        function(tagName){  // tagName is the element out of the array
                            // console.log(tempTags);
                            // tagName = tempTags[index];
                            if (!tagsObj.hasOwnProperty(tagName)) {
                                tagsObj[tagName] = 1;
                                // console.log("hello1!");
                                // console.log(tagsObj.keys());
                                // console.log(tagName);
                                // tagsObj.push({key: tagName, value: 1});
                            } else { // increment count each time we see tag again
                                // console.log(typeof tagsObj[index]);
                                console.log("Hello world! ****************")
                                tagsObj[tagName] += 1;
                                // // tagsObj[index]++;
                                // console.log(tagName); // string we want to access as key
                                // // access object using string above -> tagsObj[string]
                                // // somehow access tagsObj dictionary for which the key == string
                                // console.log(tagsObj[key=index]);
                            }
                        }
                    );

                }
                        // dataset.push(docList[i]._source.tags.length);
                      // { key: i, value: json.data[i].id} );

                // console.log(tagsObj);
                console.log(tagsObj[key="InfoVis"]);  // TODO how to access value of key "Infovis"?
                // dataset=[23, 23, 64, 70];
                // for (doc in docList) {
                //     for (tag in docList) {}
                // }
                return tagsObj;

            }

            function makeBarChart(dataset) {
                var svg = d3.select("body").append("svg");
                svg.attr("width", w)
                   .attr("height", h);
                svg.selectAll("rect")
                   .data(dataset) // TODO (dataset, key) ?
                   .enter()
                   .append("rect")
                   .attr("x", function(d, i) {
                       return i * (w / dataset.length);
                       // bar width of 20 plus 1 for padding
                   })
                   .attr("y", function(d) {
                       return h - (d.value * 30);
                       // height minus data value
                   })
                   .attr("width", w / dataset.length - barPadding)
                   .attr("height", function(d) {
                       return (d.value * 30);
                   })
                   .attr("fill", function(d) {
                       return "rgb(0,200,"+ (d.value*10) +")";
                   });
                svg.selectAll("text")
                   .data(dataset) // TODO (dataset, key) ?
                   .enter()
                   .append("text")
                   .text(function(d) {
                       return d.value; // TODO .key
                   })
                   .attr("x", function(d, i) {
                        return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
                    })
                   .attr("y", function(d) {
                        return h - (d.value * 30) + 15;
                   })
                   .attr("font-family", "sans-serif")
                   .attr("font-size", "11px")
                   .attr("fill", "white")
                   .attr("text-anchor", "middle");
            }

        </script>
    </body>
</html>
